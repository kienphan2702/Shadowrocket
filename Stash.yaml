proxy-providers: {}

proxies: []

proxy-groups:
  - name: YouTube
    type: select
    proxies:
      - DIRECT
  - name: Revenuecat
    type: select
    proxies:
      - DIRECT

# HTTP engine / script engine
http:
  mitm:
    - redirector*.googlevideo.com
    - "*.googlevideo.com"
    - "www.youtube.com"
    - "s.youtube.com"
    - "youtubei.googleapis.com"
    - "api.revenuecat.com"
    - "buy.itunes.apple.com"

script:
  # 1. YouTube chặn quảng cáo
  - name: YouTubeNoAds
    type: response
    match: ^https?:\/\/youtubei\.googleapis\.com\/youtubei\/(v\d+\/)?(player|browse|next|search|reel\/reel_watch_sequence|guide|account\/get_setting|get_watch)
    require-body: true
    binary-mode: true
    argument: null
    max-size: null
    timeout: 10

  # 2. Revenuecat (fake sub Premium)
  - name: Revenuecat
    type: response
    match: ^https:\/\/api\.revenuecat\.com\/.+\/(receipts$|subscribers\/[^/]+$)
    require-body: true
    binary-mode: true
    argument: null
    max-size: -1          # khớp với max-size=-1 trong Shadowrocket. :contentReference[oaicite:4]{index=4}
    timeout: 60

  # 3. RevenueCatDeleteHeader (xoá header gửi lên RevenueCat)
  - name: RevenueCatDeleteHeader
    type: request         # tương đương type=http-request trong Shadowrocket. :contentReference[oaicite:5]{index=5}
    match: ^https:\/\/api\.revenuecat\.com\/.+\/(receipts|subscribers)
    binary-mode: true
    argument: null
    max-size: null
    timeout: 60

  # 4. OldRoll (fake verifyReceipt từ App Store)
  - name: OldRoll
    type: response        # tương đương type=http-response. :contentReference[oaicite:6]{index=6}
    match: ^https?:\/\/buy\.itunes\.apple\.com\/verifyReceipt
    require-body: true
    binary-mode: true
    argument: null
    max-size: 0
    timeout: 60

script-providers:
  YouTubeNoAds:
    url: https://raw.githubusercontent.com/Maasea/sgmodule/master/Script/Youtube/youtube.response.js
    interval: 86400

  Revenuecat:
    url: https://raw.githubusercontent.com/kienphan2702/Shadowrocket/main/Javascript/revenuecat.js
    interval: 86400

  RevenueCatDeleteHeader:
    url: https://raw.githubusercontent.com/ddgksf2013/Scripts/master/deleteHeader.js
    interval: 86400

  OldRoll:
    url: https://raw.githubusercontent.com/kienphan2702/Shadowrocket/main/Javascript/oldroll.js
    interval: -1          # khớp script-update-interval=-1 bạn dùng cho OldRoll. :contentReference[oaicite:7]{index=7}

rules:
  - GEOSITE,youtube,YouTube
  - MATCH,Revenuecat

dns:
  default-nameserver:
    - 114.114.114.114
    - 1.1.1.1
  skip-cert-verify: true
  nameserver:
    - https://dns.nextdns.io/a72ee5

log-level: info
mode: rule
