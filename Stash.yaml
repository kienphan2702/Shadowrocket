proxy-providers: {}
proxies: []
proxy-groups:
  - name: YouTube
    type: select
    proxies:
      - DIRECT
  - name: Revenuecat
    type: select
    proxies:
      - DIRECT

# HTTP engine
http:
  mitm:
    - redirector*.googlevideo.com
    - "*.googlevideo.com"
    - "www.youtube.com"
    - "s.youtube.com"
    - "youtubei.googleapis.com"
    - "api.revenuecat.com"
    - "buy.itunes.apple.com"

  script:
    # 1. Script chặn quảng cáo YouTube
    - argument: null
      binary-mode: true
      match: ^https?:\/\/youtubei\.googleapis\.com\/youtubei\/(v\d+\/)?(player|browse|next|search|reel\/reel_watch_sequence|guide|account\/get_setting|get_watch)
      max-size: null
      name: YouTubeNoAds
      require-body: true
      timeout: 10
      type: response

    # 2. Script Revenuecat (fake sub để unlock Premium)
    - argument: null
      binary-mode: true
      match: ^https:\/\/api\.revenuecat\.com\/.+\/(receipts$|subscribers\/[^/]+$)
      max-size: null
      name: Revenuecat
      require-body: true
      timeout: 10
      type: response

    # 3. RevenueCatDeleteHeader (xoá header gửi lên RevenueCat)
    - argument: null
      binary-mode: true
      match: ^https:\/\/api\.revenuecat\.com\/.+\/(receipts|subscribers)
      name: RevenuecatDeleteHeader
      require-body: true
      binary-mode: true
      timeout: 10
      type: request

    # 4. OldRoll
    - argument: null
      binary-mode: true
      match: ^https?:\/\/buy\.itunes\.apple\.com\/verifyReceipt
      name: OldRoll
      require-body: true
      binary-mode: true
      timeout: 10
      type: response

  rewrite:
    - '(^https?:\/\/[\w-]+\.googlevideo\.com\/(?!dclk_video_ads).+?)&ctier=L(&.+?),ctier,(.+) $1$2$3 302'
    - '^https?:\/\/[\w-]+\.googlevideo\.com\/(?!(dclk_video_ads|videoplayback\?)).+&oad - reject-200'
    - '^https?:\/\/(www|s)\.youtube\.com\/api\/stats\/ads - reject-200'
    - '^https?:\/\/(www|s)\.youtube\.com\/(pagead|ptracking) - reject-200'
    - '^https?:\/\/s\.youtube\.com\/api\/stats\/qoe\?adcontext - reject-200'

script-providers:
  YouTubeNoAds:
    url: https://raw.githubusercontent.com/Maasea/sgmodule/master/Script/Youtube/youtube.response.js
    interval: 86400
  Revenuecat:
    url: https://raw.githubusercontent.com/kienphan2702/Shadowrocket/refs/heads/main/Javascript/revenuecat.js
    interval: 86400
  RevenueCatDeleteHeader:
    url: https://raw.githubusercontent.com/ddgksf2013/Scripts/master/deleteHeader.js
    interval: 86400
  OldRoll:
    url: https://raw.githubusercontent.com/kienphan2702/Shadowrocket/main/Javascript/oldroll.js
    interval: -1

rules:
  - GEOSITE,youtube,YouTube
  - MATCH,Revenuecat

dns:
  default-nameserver:
    - 114.114.114.114
    - 1.1.1.1
  skip-cert-verify: true
  nameserver:
    - https://dns.nextdns.io/a72ee5

log-level: info
mode: rule
