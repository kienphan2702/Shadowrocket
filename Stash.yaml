proxy-providers: {}
proxies: []
proxy-groups:
  - name: YouTube
    type: select
    proxies:
      - DIRECT
  - name: Revenuecat
    type: select
    proxies:
      - DIRECT

# HTTP engine
http:
  mitm:
    - redirector*.googlevideo.com
    - "*.googlevideo.com"
    - "www.youtube.com"
    - "s.youtube.com"
    - "youtubei.googleapis.com"
    - "api.revenuecat.com"

  script:
    # 1. Script YouTube Premium
    - match: ^https?:\/\/youtubei\.googleapis\.com\/youtubei\/(v\d+\/)?(player|browse|next|search|reel\/reel_watch_sequence|guide|account\/get_setting|get_watch)
      name: YouTubeNoAds
      type: response
      require-body: true
      binary-mode: true
      timeout: 10

    # 2. Script Revenuecat
    - match: ^https:\/\/api\.revenuecat\.com\/.+\/(receipts$|subscribers\/[^/]+$)
      name: Revenuecat
      type: response
      require-body: true
      binary-mode: true
      timeout: 10

  rewrite:
    - '(^https?:\/\/[\w-]+\.googlevideo\.com\/(?!dclk_video_ads).+?)&ctier=L(&.+?),ctier,(.+) $1$2$3 302'
    - '^https?:\/\/[\w-]+\.googlevideo\.com\/(?!(dclk_video_ads|videoplayback\?)).+&oad - reject-200'
    - '^https?:\/\/(www|s)\.youtube\.com\/api\/stats\/ads - reject-200'
    - '^https?:\/\/(www|s)\.youtube\.com\/(pagead|ptracking) - reject-200'
    - '^https?:\/\/s\.youtube\.com\/api\/stats\/qoe\?adcontext - reject-200'

script-providers:
  YouTubeNoAds:
    url: https://raw.githubusercontent.com/Maasea/sgmodule/master/Script/Youtube/youtube.response.js
    interval: 86400
  Revenuecat:
    url: https://raw.githubusercontent.com/kienphan2702/Shadowrocket/main/Javascript/revenuecat.js
    interval: 86400

rules:
  - GEOSITE,youtube,YouTube
  - MATCH,Revenuecat

dns:
  default-nameserver:
    - 114.114.114.114
    - 1.1.1.1
  skip-cert-verify: true
  nameserver:
    - https://dns.nextdns.io/a72ee5

log-level: info
mode: rule
